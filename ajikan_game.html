<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Title</title>
    <base href="https://timagribanov.github.io/"/>
    <link rel="me"
          href="https://twitter.com/twitterdev"
    >

    <style type="text/css">
        @font-face {
            font-family: BloggerSans;
            src: url('Blogger_Sans.otf');
        }

        body {
            color: #000;
            background-color: #fff;
        }

        a,
        a:visited,
        a:active {
            color: #0099ff;
            text-decoration: none;
        }

        #mainTable{
            font-size: 16px;
            font-family: 'BloggerSans', sans-serif;
            text-align: center;
            vertical-align: middle;
            width: 410px;
            margin-left: auto;
            margin-right: auto;
            border-collapse: separate;
            border-spacing: 10px 5px;
        }
        #leftField{
            width: 120px;
            height: 150px;
            border: 1px solid #000;
            cursor: pointer;
        }
        #rightField{
            width: 120px;
            height: 150px;
            border: 1px solid #000;
            cursor: pointer;
        }
        .middleField{
            width: 120px;
            height: 70px;
            border: 1px solid #000;
            cursor: pointer;
        }

        #resultField {
            text-align: center;
        }
    </style>

    <script type="text/javascript">
        //*********************************************************
        //
        // 評価するメンバーの名前のリスト
        //
        // この部分を変更して下さい。名前の削除・追加も可能です。
        // 名前を引用符(")で括り、コンマ(,)で区切って下さい。
        // 但し、リストの最後にはコンマを入れてはいけません。
        //
        //*********************************************************
        var namMember = ["Haruka Kanata",
            "Rashinban",
            "Konayuki",
            "Ao no Uta",
            "Sunday",
            "12",
            "Flashback",
            "Mirai no Kakera",
            "Denpatou",
            "Understand",
            "Natsu no Hi, Zanzou",
            "Mugen Glider",
            "Sono Wake wo",
            "N.G.S",
            "Jihei Tansaku",
            "E",
            "Kimi to Iu Hana",
            "No Name",
            "Shindoukaku",
            "Rewrite",
            "Kimi no Machi made",
            "My World",
            "Yoru no Mukou",
            "Last Scene",
            "Siren",
            "Re:Re:",
            "24ji",
            "Mayonaka to Mahiru no Yume",
            "Kaigan Doori",
            "Koop&Loop",
            "Angou no Waltz",
            "World Apart",
            "Blackout",
            "Sakurasou",
            "Rojiura no Usagi",
            "Blue Train",
            "Mafuyu no Dance",
            "Butterfly",
            "Senseless",
            "Gekkou",
            "Tightrope",
            "World World World",
            "After Dark",
            "Tabidatsu Kimi e",
            "Neoteny",
            "Travelogue",
            "No 9",
            "Night Diving",
            "Laika",
            "Wakusei",
            "Korogaru Iwa, Kimi ni Asa ga Furu",
            "World World",
            "Aru Machi no Gunjou",
            "Atarashii Sekai",
            "Myakuutsu Seimei",
            "Science Fiction",
            "Mustang",
            "Shinkokyuu",
            "Yuusetsu",
            "Mada Minu Ashita ni",
            "藤沢ルーザー",
            "鵠沼サーフ",
            "江ノ島エスカー",
            "腰越クライベイビー",
            "七里ヶ浜スカイウォーク",
            "稲村ヶ崎ジェーン",
            "極楽寺ハートブレイク",
            "長谷サンズ",
            "由比ヶ浜カイト",
            "鎌倉グッドバイ",
            "新世紀のラブソング",
            "マジックディスク",
            "双子葉",
            "迷子犬と雨のビート",
            "架空生物のブルース",
            "ラストダンスは悲しみを乗せて",
            "マイクロフォン",
            "ライジングサン",
            "イエス",
            "橙",
            "ソラニン",
            "マーチングバンド",
            "Ａｌｌ　ｒｉｇｈｔ　ｐａｒｔ２",
            "Ｎ２",
            "１．２．３．４．５．６．Ｂａｂｙ",
            "ＡとＺ",
            "大洋航路",
            "バイシクルレース",
            "それでは、また明日",
            "１９８０",
            "マシンガンと形容詞",
            "レールロード",
            "踵で愛を打ち鳴らせ",
            "アネモネの咲く春に",
            "Ｅａｓｔｅｒ／復活祭",
            "Ｌｉｔｔｌｅ　Ｌｅｎｎｏｎ／小さなレノン",
            "Ｗｉｎｎｅｒ　ａｎｄ　Ｌｏｓｅｒ／勝者と敗者",
            "Ｃａｔｅｒｐｉｌｌａｒ／芋虫",
            "Ｅｔｅｒｎａｌ　Ｓｕｎｓｈｉｎｅ／永遠の陽光",
            "Ｐｌａｎｅｔ　ｏｆ　ｔｈｅ　Ａｐｅｓ／猿の惑星",
            "Ｓｔａｎｄａｒｄ／スタンダード",
            "Ｗｏｎｄｅｒ　Ｆｕｔｕｒｅ／ワンダーフューチャー",
            "Ｐｒｉｓｏｎｅｒ　ｉｎ　ａ　Ｆｒａｍｅ／額の中の囚人",
            "Ｓｉｇｎａｌ　ｏｎ　ｔｈｅ　Ｓｔｒｅｅｔ／街頭のシグナル",
            "Ｏｐｅｒａ　Ｇｌａｓｓｅｓ／オペラグラス",
            "振動覚（２０１６）",
            "リライト（２０１６）",
            "ループ＆ループ（２０１６）",
            "君の街まで（２０１６）",
            "マイワールド（２０１６）",
            "夜の向こう（２０１６）",
            "ラストシーン（２０１６）",
            "サイレン（２０１６）",
            "Ｒｅ：Ｒｅ：（２０１６）",
            "２４時（２０１６）",
            "真夜中と真昼の夢（２０１６）",
            "海岸通り（２０１６）",
            "エントランス",
            "ロケットＮｏ．４",
            "絵画教室",
            "サイレン＃",
            "夕暮れの紅",
            "Ｈｏｌｄ　ｍｅ　ｔｉｇｈｔ",
            "ロードムービー",
            "飛べない魚",
            "堂々巡りの夜",
            "嘘とワンダーランド",
            "永遠に",
            "ローリングストーン",
            "スローダウン",
            "十二進法の夕景",
            "夏蝉",
            "夜のコール",
            "白に染めろ",
            "雨上がりの希望",
            "ひかり",
            "オールドスクール",
            "リロードリロード",
            "夜を越えて",
            "冷蔵庫のろくでもないジョーク",
            "ケモノノケモノ",
            "今を生きて",
            "パラレルワールド",
            "シーサイドスリーピング",
            "Ｒｉｇｈｔ　Ｎｏｗ",
            "タイムトラベラー",
            "ブラッドサーキュレーター",
            "八景",
            "荒野を歩け",
            "お祭りのあと",
            "ボーイズ＆ガールズ",
            "祝日",
            "クロックワーク",
            "ホームタウン",
            "レインボーフラッグ",
            "サーカス",
            "ＵＣＬＡ",
            "モータープール",
            "ダンシングガール",
            "さようならソルジャー",
            "スリープ",
            "廃墟の記憶",
            "イエロー",
            "はじまりの季節",
            "生者のマーチ",
            "Ｄｏｒｏｒｏ",
            "解放区"];
        //*********************************************************

        var lstMember = [];
        var parent = [];
        var equal = [];
        var rec = [];
        var cmp1,cmp2;
        var head1,head2;
        var nrec;

        var numQuestion;
        var totalSize;
        var finishSize;
        var finishFlag;

        var knownFlag = [];

        //変数の初期化+++++++++++++++++++++++++++++++++++++++++++++
        function initList(){
            var n = 0;
            var mid;
            var i;

            //ソートすべき配列
            lstMember[n] = [];
            for (i=0; i<namMember.length; i++) {
                lstMember[n][i] = i;
            }
            parent[n] = -1;
            totalSize = 0;
            n++;

            for (i=0; i<lstMember.length; i++) {
                //要素数が２以上なら２分割し、
                //分割された配列をlstMemberの最後に加える
                if(lstMember[i].length>=2) {
                    mid = Math.ceil(lstMember[i].length/2);
                    lstMember[n] = [];
                    lstMember[n] = lstMember[i].slice(0,mid);
                    totalSize += lstMember[n].length;
                    parent[n] = i;
                    n++;
                    lstMember[n] = [];
                    lstMember[n] = lstMember[i].slice(mid,lstMember[i].length);
                    totalSize += lstMember[n].length;
                    parent[n] = i;
                    n++;
                }
            }

            //保存用配列
            for (i=0; i<namMember.length; i++) {
                rec[i] = 0;
            }
            nrec = 0;

            //引き分けの結果を保存するリスト
            //キー：リンク始点の値
            // 値 ：リンク終点の値
            for (i=0; i<=namMember.length; i++) {
                equal[i] = -1;
            }

            cmp1 = lstMember.length-2;
            cmp2 = lstMember.length-1;
            head1 = 0;
            head2 = 0;
            numQuestion = 1;
            finishSize = 0;
            finishFlag = 0;

            // 知っているかどうかのフラグ(0:初期値 1:知っていることが確定 -1:知らないことが確定)
            for (i=0; i<=namMember.length; i++) {
                knownFlag[i] = 0;
            }
        }

        //リストのソート+++++++++++++++++++++++++++++++++++++++++++
        //flag：比較結果
        //  -1：左を選択
        //   0：引き分け
        //   1：右を選択
        //  10:両方知らないを選択
        function sortList(flag){
            var mem1, mem2;

            sortList2(flag);

            while(cmp1>=0){
                mem1 = lstMember[cmp1][head1];
                mem2 = lstMember[cmp2][head2];
                if(knownFlag[mem1]===-1 && knownFlag[mem2]===-1){
                    // 両方知らない
                    sortList2(10);
                }
                else if(knownFlag[mem1]===1 && knownFlag[mem2]===-1){
                    // 左を勝たせる
                    sortList2(-1);
                }
                else if(knownFlag[mem1]===-1 && knownFlag[mem2]===1){
                    // 右を勝たせる
                    sortList2(1);
                }
                else{
                    break;
                }
            }

            if (cmp1<0) {
                // 「○%」で表示(デフォルト)
                str = "Battle No."+(numQuestion-1)+"<br>"+Math.floor(finishSize*100/totalSize)+"% sorted.";
                // 「○/○」で表示
                //	str = "Battle No."+(numQuestion-1)+"<br>"+finishSize + "/" + totalSize+" sorted.";
                // 「○%(○/○)」で表示
                //	str = "Battle No."+(numQuestion-1)+"<br>"+Math.floor(finishSize*100/totalSize)+"% ("+finishSize+"/"+totalSize+") sorted.";
                document.getElementById("battleNumber").innerHTML = str;

                showResult();
                finishFlag = 1;
            }
            else {
                showImage();
            }
        }

        // 再帰で呼びやつ(勝敗の計算のみで表示はしない)
        function sortList2(flag){
            var i;
            var str;

            //recに保存
            if (flag===-1) {
                knownFlag[lstMember[cmp1][head1]] = 1;
                do{
                    rec[nrec] = lstMember[cmp1][head1];
                    head1++;
                    nrec++;
                    finishSize++;
                } while (equal[rec[nrec-1]]!==-1);
            }
            else if (flag===1) {
                knownFlag[lstMember[cmp2][head2]] = 1;
                do{
                    rec[nrec] = lstMember[cmp2][head2];
                    head2++;
                    nrec++;
                    finishSize++;
                } while (equal[rec[nrec-1]]!==-1 );
            }
            else {
                if(flag===10){
                    knownFlag[lstMember[cmp1][head1]] = -1;
                    knownFlag[lstMember[cmp2][head2]] = -1;
                }
                else{
                    knownFlag[lstMember[cmp1][head1]] = 1;
                    knownFlag[lstMember[cmp2][head2]] = 1;
                }

                do{
                    rec[nrec] = lstMember[cmp1][head1];
                    head1++;
                    nrec++;
                    finishSize++;
                } while (equal[rec[nrec-1]]!==-1);
                equal[rec[nrec-1]] = lstMember[cmp2][head2];
                do{
                    rec[nrec] = lstMember[cmp2][head2];
                    head2++;
                    nrec++;
                    finishSize++;
                } while (equal[rec[nrec-1]]!==-1);
            }

            //片方のリストを走査し終えた後の処理
            if (head1<lstMember[cmp1].length && head2===lstMember[cmp2].length) {
                //リストcmp2が走査済 - リストcmp1の残りをコピー
                while (head1<lstMember[cmp1].length){
                    rec[nrec] = lstMember[cmp1][head1];
                    head1++;
                    nrec++;
                    finishSize++;
                }
            }
            else if (head1===lstMember[cmp1].length && head2<lstMember[cmp2].length) {
                //リストcmp1が走査済 - リストcmp2の残りをコピー
                while (head2<lstMember[cmp2].length){
                    rec[nrec] = lstMember[cmp2][head2];
                    head2++;
                    nrec++;
                    finishSize++;
                }
            }

            //両方のリストの最後に到達した場合は
            //親リストを更新する
            if (head1===lstMember[cmp1].length && head2===lstMember[cmp2].length) {
                for (i=0; i<lstMember[cmp1].length+lstMember[cmp2].length; i++) {
                    lstMember[parent[cmp1]][i] = rec[i];
                }
                lstMember.pop();
                lstMember.pop();
                cmp1 = cmp1-2;
                cmp2 = cmp2-2;
                head1 = 0;
                head2 = 0;

                //新しい比較を行う前にrecを初期化
                if (head1===0 && head2===0) {
                    for (i=0; i<namMember.length; i++) {
                        rec[i] = 0;
                    }
                    nrec = 0;
                }
            }
        }

        //結果の表示+++++++++++++++++++++++++++++++++++++++++++++++
        function showResult() {
            var ranking = 1;
            var sameRank = 1;
            var str = "";
            var i;

            str += "<table style=\"width:200px; font-size:12px; line-height:120%; margin-left:auto; margin-right:auto; border:1px solid #000; border-collapse:collapse\" align=\"center\">";
            str += "<tr><td style=\"color:#ffffff; background-color:#000; text-align:center;\">順位<\/td><td style=\"color:#ffffff; background-color:#000; text-align:center;\">名前<\/td><\/tr>";

            for (i=0; i<namMember.length; i++) {
                str += "<tr><td style=\"border:1px solid #000; text-align:right; padding-right:5px;\">"+ranking+"<\/td><td style=\"border:1px solid #000; padding-left:5px;\">"+namMember[lstMember[0][i]]+"<\/td><\/tr>";
                if (i<namMember.length-1) {
                    if (equal[lstMember[0][i]]===lstMember[0][i+1]) {
                        sameRank++;
                    } else {
                        ranking += sameRank;
                        sameRank = 1;
                    }
                }
            }
            str += "<\/table>";

            document.getElementById("resultField").innerHTML = str;
        }

        //比較する２つ要素の表示+++++++++++++++++++++++++++++++++++
        function showImage() {
            // 「○%」で表示(デフォルト)
            var str0 = "Battle No."+numQuestion+"<br>"+Math.floor(finishSize*100/totalSize)+"% sorted.";
            // 「○/○」で表示
//	var str0 = "Battle No."+numQuestion+"<br>"+finishSize + "/" + totalSize+" sorted.";
            // 「○%(○/○)」で表示
//	var str0 = "Battle No."+numQuestion+"<br>"+Math.floor(finishSize*100/totalSize)+"% ("+finishSize+"/"+totalSize+") sorted.";

            var str1 = ""+toNameFace(lstMember[cmp1][head1]);
            var str2 = ""+toNameFace(lstMember[cmp2][head2]);

            document.getElementById("battleNumber").innerHTML = str0;
            document.getElementById("leftField").innerHTML = str1;
            document.getElementById("rightField").innerHTML = str2;

            numQuestion++;
        }

        //数値を名前（顔文字）に変換+++++++++++++++++++++++++++++++
        function toNameFace(n){
            var str = namMember[n];

            //顔文字を追加する場合は以下のコメントアウトを外す
            //namMemberのインデックスと矛盾しないように注意
            /*
            str += "<br>────<br>";
            switch(n) {
                //case -1 はサンプルなので削除すること
                case -1: str+="（ ´∀｀）";break;
                default: str+=""+n;
            }
            */
            return str;
        }
        //-->
    </script>
</head>
<body>
    <table id="mainTable">
        <tbody>
        <tr>
            <td id="battleNumber" colspan="3">&nbsp;</td>
        </tr>
        <tr>
            <td id="leftField" onclick="if(finishFlag===0)sortList(-1);" rowspan="2">&nbsp;</td>
            <td class="middleField" onclick="if(finishFlag===0)sortList(0);">Ничья</td>
            <td id="rightField" onclick="if(finishFlag===0)sortList(1);" rowspan="2">&nbsp;</td>
        </tr>
        <tr>
            <td class="middleField" onclick="if(finishFlag===0)sortList(10);">Не могу решить</td>
        </tr>
        </tbody>
    </table>

    <br/><br/>

    <div id="resultField"></div>
    <p>Пользоательница Твиттера под ником <a href="https://twitter.com/hirono_akg">@hirono_akg</a>, будучи большой фанаткой Asian Kung-Fu Generation, создала такую игру, которая позволяет определить вашу любимую песню группы. Я же её только перевёл.</p>
    <br/>
    <p>Выберите любимую песню Asian Kung-Fu Generation.<br/>Выберите вашу любимую песню из двух или укажите между ними ничью.<br/>Это не официальная игра.</p>
    <p>В игру включены все песни, начиная с мини-альбома «Houkai Amplifier», на состояние октября 2019 года.<br/>Песни с «Feedback File», «Feedback File 2» и B-сайды с синглов, не вошедшие на альбомы, включены в игру. В игру не вошли каверы (например, «Hello Hello» и «Loser»).<br/>Песни с переиздания альбома «Sol-Fa», которое вышло в 2016, помечены как (2016). В игру попало 167 песен, поэтому она долгая.</p>
    <br/>
    <p>Оригинал игры на японском <a href="http://yakisobaoisiidesu.web.fc2.com/akgsort.html">здесь</a>.</p>
    <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-text=" — моя любимая песня #AsianKungFuGenration" data-url="https://timagribanov.github.io/ajikan_tournament/ajikan_game.html" data-via="akfgfragments_ru" data-related="hirono_akg,gotch_akg" data-lang="ru" data-show-count="false">Tweet</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

    <script>// <![CDATA[
    initList();
    showImage();
    // ]]></script>
</body>
</html>